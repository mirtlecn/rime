# Rime schema
# encoding: utf-8

schema:
  schema_id: cn
  name: åŒæ‹¼é¹¤
  version: "2024.04"
  dependencies:
    - radical
    - stroke
    - en

switches:
  - name: ascii_mode
    reset: 0
    states: [ä¸­, è‹±]
  - name: traditionalize
    reset: 0
    states: [ç®€, è‡º]
  - name: simplify
    reset: 0
    states: [åŸ, ç®€]
  - name: emoji
    reset: 1
    states: [ğŸˆšï¸, ğŸˆ¶]
  - name: reverse_simp
    states: [åˆ†, åˆ]
  # - name: parrot_translator
  #   reset: 0
  #   states: [å…³, é€ ]
  - name: search_single_char
    states: [è¯, å•]
  - name: completion
    reset: 0
    states: [è¡¥, å…³]

engine:
  processors:
    - ascii_composer
    - lua_processor@*processor
    - recognizer
    # - lua_processor@*select_index
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@reverse_lookup
    - affix_segmentor@radical_lookup
    - affix_segmentor@stroke_lookup
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - script_translator
    - table_translator@cn_flypy
    - table_translator@en
    - table_translator@radical_lookup
    - table_translator@stroke_lookup
    - lua_translator@*number_translator
    - lua_translator@*unicode
    - table_translator@cn_en_flypy
  filters:
    - simplifier@simplify
    - simplifier@emoji
    - simplifier@traditionalize
    - reverse_lookup_filter@radical_reverse_lookup
    - reverse_lookup_filter@stroke_reverse_lookup
    - simplifier@reverse_simp
    - lua_filter@*search
    - lua_filter@*filter
    - uniquifier

processor:
  debug: false
  length_limit: 60
  commit_history_key: "tt" # æŒ‰ä¸‹æ­¤é”®ç›´æ¥ä¸Šå±ä¸Šä¸€æ¬¡çš„è¾“å…¥
  # clear_history_key:
  # æ£€æµ‹åˆ°æ­¤é”®ï¼ˆä¸å½±å“è¯¥é”®åŠŸèƒ½ï¼‰ï¼Œæ¸…ç©ºå½“å‰ä¼šè¯ï¼ˆè¿›ç¨‹ï¼‰çš„å†å²æäº¤è®°å½•
  # rime ä¸­ï¼Œç©ºæ ¼ã€é€€æ ¼ç­‰æŒ‰é”®éƒ½ä¼šæ¸…ç©ºå†å²æäº¤è®°å½•
  # è„šæœ¬æ·»åŠ äº† Escapeï¼ŒUpï¼ŒDown ä»¥åŠ Shift + Return é”®æ¸…ç©ºè®°å½•
  # è¯¥é€‰é¡¹çš„ç”¨ä¾‹ï¼šå°†å…¶è®¾ç½®ä¸ºå¯åŠ¨å™¨ï¼ˆlauncherï¼‰çš„å¿«æ·é”®ï¼Œæ¯è§¦å‘ä¸€æ¬¡éƒ½ä¼šé‡ç½®è¾“å…¥çŠ¶æ€
  # - Release+Alt_R
  # - Release+Alt_L

  # ä»¥ä¸‹ä¸‰ä¸ªè§„åˆ™ï¼š
  # å¤„ç† [ASCII ç è¡¨](https://zh.wikipedia.org/wiki/ASCII) 0x21-0x7e å­—ç¬¦ï¼ˆ**ä¸åŒ…å«ç©ºæ ¼**ï¼‰
  # ä¸¤ä¸ªåæ–œæ ä»£æ›¿æ–œæ ï¼ˆ \\ -> /ï¼‰
  # ç™¾åˆ†å·å¼€å¤´çš„ç‰¹æ®Šç¬¦å·å‚è€ƒ <https://www.lua.org/pil/20.2.html>
  ascii_rules:
    # - ascii/A/B/
    # ä¸Šä¸€æ¬¡ä¸Šå±è¯ç»“å°¾æ˜¯ A å­—ç¬¦ï¼Œåˆ™å°†è¦è¾“å…¥çš„ B å­—ç¬¦å°†ä»¥ ASCII ç å½¢å¼ç›´æ¥ä¸Šå±
    # å†å²å­—ç¬¦ç•™ç©ºè¡¨ç¤ºï¼Œéç¼–è¾‘æƒ…å†µä¸‹ï¼Œè¯¥æŒ‰é”®å§‹ç»ˆä»¥ ascii å½¢å¼ä¸Šå±
    # - ascii//%d~/
    # - ascii/`/`/
    # - ascii/%d/-.,:+*\\/
    - ascii/\\/\\/
    - ascii/././
    - ascii/+-/+-/
    - ascii/_/_/
    - ascii/:/\\/
    - ascii/'"/'"])>}/
    # - ascii/:_`+,;-\\./%a/
    # - ascii/%a/([<{_`+-\\'"%a/
    - ascii/!/[/
    # - ascii/[]/%w[]()'"/
    # - ascii/(/%w)[]'"/
    # - ascii/</%w>'"/
    # - ascii/{}/%w{}'"/
    - ascii/[]/[]()'"/
    - ascii/(/)[]'"/
    - ascii/</>'"/
    - ascii/{}/{}'"/
  cn_rules:
    # ä¸­æ–‡åçš„ç¬¦å·è½¬æ¢è§„åˆ™ï¼Œå’Œ rime çš„ç®—æ³•è§„åˆ™ä¸€è‡´
    - xlit/.,?!:;|[{(\/ã€‚ï¼Œï¼Ÿï¼ï¼šï¼›Â·ã€Œã€ï¼ˆã€/
    - xform _ â€”â€”
    - xform \^ â€¦â€¦
    # - xform ã€Œ ã€Œã€
    # - xform ã€ ã€ã€
    # - xform ï¼ˆ ï¼ˆï¼‰
  custom_rules:
    # ä¼˜å…ˆçº§æœ€é«˜ï¼Œæœ€å…ˆå¤„ç†
    # fnr/å†å²å­—ç¬¦/æŒ‰é”®å­—ç¬¦/ä¸Šå±å†…å®¹/
    # å†å²ã€æŒ‰é”®å­—ç¬¦å‰åŠ  %% ä¸ºå­—ç¬¦é›†åŒ¹é…
    # ä¸Šå±å­—ç¬¦ä¸º %%1 -> ç¦ç”¨æ­¤æŒ‰é”®
    # ä¸Šå±å­—ç¬¦ä¸º %%2 -> æ”¾è¡Œæ­¤æŒ‰é”®
    # ä¸Šå±å­—ç¬¦ä¸º %%0 -> ç³»ç»Ÿå¤„ç†æŒ‰é”®
    # <https://github.com/hchunhui/librime-lua/wiki/Scripting#lua_processor>
    - fnr/%%ã€Œã€/%%"]/ã€/
    - fnr/ã€/%%'}/ã€/
    - fnr/ï¼ˆ/)/ï¼‰/
    - fnr/!/[/[]()/
    - fnr/%%ã€Šã€‰/>/ã€‹/
    - fnr/ã€ˆ/>/ã€‰/
    - fnr/ï¼š/%%'[/ã€Œ/
    - fnr/ï¼š/"/â€œâ€/
    - fnr/ï¼š/%%{"/ã€/
    - fnr/ï¼š/'/â€˜â€™/
    - fnr/ã€/%%]}/ã€‘/
    - fnr/ã€”/%%]}/ã€•/
    - fnr/ã€–/%%]}/ã€—/
    - fnr/%%â€œâ€™/%%]}/â€/
    - fnr/%%â€ã€ã€ï¼‰ã€‹ã€‰â€™/./ã€‚/
    - fnr/%%â€ã€ã€ï¼‰ã€‹ã€‰â€™/,/ï¼Œ/
    - fnr/%%ï¼ï¼Ÿâ€ã€ã€ï¼‰ã€‹ã€‰â€™/?/ï¼Ÿ/
    - fnr/%%ï¼ï¼Ÿâ€ã€ã€ï¼‰ã€‹ã€‰â€™/!/ï¼/
    - fnr/â€˜/%%]}/â€™/

search:
  show_other_cands: false
  wildcard: "~" # ä»…æ”¯æŒ db åæŸ¥
  db:
    - radical_flypy
    - tone
    - stroke
  fuma_format:
    - xlit/ABCDE/12345/
  input2code_format:
    - xform/([bpmfdtnljqx])n/$1iao/
    - xform/(\w)g/$1eng/
    - xform/(\w)q/$1iu/
    - xform/(\w)w/$1ei/
    - xform/([dtnlgkhjqxyvuirzcs])r/$1uan/
    - xform/(\w)t/$1ve/
    - xform/(\w)y/$1un/
    - xform/([dtnlgkhvuirzcs])o/$1uo/
    - xform/(\w)p/$1ie/
    - xform/([jqx])s/$1iong/
    - xform/(\w)s/$1ong/
    - xform/(\w)d/$1ai/
    - xform/(\w)f/$1en/
    - xform/(\w)h/$1ang/
    - xform/(\w)j/$1an/
    - xform/([gkhvuirzcs])k/$1uai/
    - xform/(\w)k/$1ing/
    - xform/([jqxnl])l/$1iang/
    - xform/(\w)l/$1uang/
    - xform/(\w)z/$1ou/
    - xform/([gkhvuirzcs])x/$1ua/
    - xform/(\w)x/$1ia/
    - xform/(\w)c/$1ao/
    - xform/([dtgkhvuirzcs])v/$1ui/
    - xform/(\w)b/$1in/
    - xform/(\w)m/$1ian/
    - xform/([aoe])\1(\w)/$1$2/
    - "xform/(^|[ '])v/$1zh/"
    - "xform/(^|[ '])i/$1ch/"
    - "xform/(^|[ '])u/$1sh/"
    - xform/([jqxy])v/$1u/
    - xform/aa/a/
    - xform/ee/e/
    - xform/oo/o/

parrot_translator:
  schema: en
  # remove_punct: "."
  always_on: false
  space_alt: "~"
  comment: "+"
  ignore_string: "`"
  # ignore_pattern:
  #   # - "^[^@]*%w+%.%w+[^@]*$"
  #   - ""

filter:
  en_schema: en
  case_tip: false
  mark_user_dict: false
  add_space_cn_en: false
  recode_cn_en: true
  add_space_en: false
  comment_format:
    - erase/^.*â˜¯.*$/
    - erase/^ã€”(åŠè§’|å…¨è§’)ã€•$/
    # - erase/^ã€”åŠè§’ã€•$/
    # - xform/åŠè§’/åŠ/
    # - xform/å…¨è§’/å…¨/
    - erase/^\s+$/
    - xform/(.) $/$1/
    - xform/^ (.)/$1/
    - xform/^ã€”|ã€•$//
    - xform/^/(/
    - xform/$/)/
    # - xform/\(åŠè§’\)/â—/
    # - xform/\(å…¨è§’\)/â—/
  # show_in_comment:
  # - comment
  # - type
  # - get_dynamic_type()
  # - preedit
  # - quality

en:
  dictionary: en
  db_class: tabledb
  enable_sentence: false
  initial_quality: 1.1
  preedit_format:
    - xform/ /
  comment_format:
    - xform/^.+$//

cn_en_flypy:
  dictionary: ""
  user_dict: cn_en_flypy
  db_class: stabledb
  enable_completion: true
  initial_quality: 0.5
  comment_format:
    - xform/^.+$//

cn_flypy:
  dictionary: ""
  user_dict: cn_dicts/cn_flypy
  db_class: stabledb
  enable_sentence: false
  enable_completion: false
  initial_quality: 99
  comment_format:
    - xform/^.+$//

emoji:
  option_name: emoji
  opencc_config: emoji_only.json
  tags: [abc]
  # tips: all

translator:
  dictionary: cn
  initial_quality: 1.2
  # enable_correction: false
  # enable_completion: true
  # user_dict: pinyin
  preedit_format:
    - xform/([0-9]) ([0-9])/$1$2/
    - xform/([0-9]) ([0-9])/$1$2/
    - xform/ /'/
    # - xform/([jqxy])v/$1u/
    # - xform/(.)v/$1Ã¼/
  # packs:
  #   - cn_pack

traditionalize:
  option_name: traditionalize
  opencc_config: s2twp.json
  # tips: all
  tags: [abc, number]

simplify:
  option_name: simplify
  opencc_config: t2s.json
  # tips: all
  tags: [abc]
  # tips: all
  # show_in_comment: true
  append_comment: true
  inherit_comment: true

reverse_simp:
  option_name: reverse_simp
  opencc_config: t2s.json
  tips: all
  show_in_comment: true
  append_comment: true
  inherit_comment: true
  tags: [radical_lookup, stroke_lookup, reverse_lookup]
  # comment_format:
  #   - xform/^/(/
  #   - xform/$/)/

punctuator:
  import_preset: default
  half_shape:
    ",": ï¼Œ
    ".": ã€‚
    "<": ["<", ã€Š, ã€ˆ]
    ">": [">", ã€‹, ã€‰]
    "/": ["/"]
    "?": [ï¼Ÿ]
    ";": ï¼›
    ":": ï¼š
    "'": ["'", "â€˜", "â€œ"]
    '"': ['"', "â€™", "â€"]
    '\': [ã€, '\']
    "|": ["|", "â€¢"]
    "~": ["~"]
    "!": ï¼
    "@": ['@']
    "#": ["#","&","%"]
    "*": ["*",'@']
    "(": ['ï¼ˆ', "ã€Œ", "ã€", "ã€", "{"]
    ")": ['ï¼‰',"ã€", "ã€", "ã€‘", "}"]
    "-": [â€”â€”, "_", "-",'â€¦â€¦']
    "+": "+"
    "=": "="

key_binder:
  import_preset: default
  select_first_character: plus
  select_last_character: equal
  search: "`"
  bindings:
    - { accept: at, send: grave, when: always }
    - { accept: "Control+Shift+F3", toggle: traditionalize, when: always }
    - { accept: "Control+Shift+F4", toggle: emoji, when: always }
    - { accept: "Control+Shift+F5", toggle: simplify, when: has_menu }
    - { accept: "Control+r", toggle: reverse_simp, when: has_menu }
    # - { accept: "Control+p", toggle: parrot_translator, when: has_menu }
    - { accept: "Control+s", toggle: search_single_char, when: has_menu }
    - { accept: "Control+c", toggle: completion, when: has_menu }

reverse_lookup:
  tag: reverse_lookup
  prefix: "`"
  # suffix: "~"
  tips: "[æŸ¥]"
  # closing_tips: ""
  extra_tags:
    - radical_lookup
    - stroke_lookup

radical_reverse_lookup:
  tags: [radical_lookup]
  # overwrite_comment: true
  # append_comment: true
  dictionary: zdict
  # comment_format:
  #   - xform/^/(/
  #   - xform/$/)/

stroke_reverse_lookup:
  tags: [stroke_lookup]
  # append_comment: true
  dictionary: zdict
  # overwrite_comment: true

radical_lookup:
  tag: radical_lookup
  dictionary: radical_flypy
  # enable_user_dict: false
  enable_sentence: false
  # max_phrase_length: 1
  prefix: "`C"
  # suffix: "~"
  tips: "[æ‹†]"
  # closing_tips: "<æ‹†"
  comment_format:
    - erase/^.*$//

stroke_lookup:
  tag: stroke_lookup
  enable_sentence: false
  # enable_user_dict: false
  dictionary: stroke
  prefix: "`B"
  tips: "[ç¬”]"
  # closing_tips: "<ç¬”"
  comment_format:
    - erase/^.*$//

recognizer:
  patterns:
    punct: "^``.*$"
    win_path: "^[A-Za-z]:.*"
    hyphen: "^[A-Za-z0-9]+[-_/~.:'].*"
    reverse_lookup: "^`[a-z;]+$"
    radical_lookup: "^`C[a-z;]+$"
    stroke_lookup: "^`B[hspnz]+$"
    unicode: "^`U[a-fA-F0-9]+"
    number: "^`[0-9]+[.]?[0-9]*"

speller:
  alphabet: zyxwvutsrqponmlkjÃ¼ihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA~`1234567890
  initials: zyxwvutsrqponmlkjÃ¼ihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA`
  delimiter: " '"
  algebra:
    # - erase/^xx$/
    # æ¨¡ç³ŠéŸ³
    # - derive/^n/l/
    # - derive/^l/n/
    # - derive/ing$/in/
    # - derive/in$/ing/
    # - derive/^([jqxy])u$/$1v/
    # - derive/^([aoe])([ioun])$/$1$1$2/
    # ä¸‹é¢æ˜¯è½¬åŒ–
    - xform/^([aoe])(ng)?$/$1$1$2/
    - xform/iu$/<q>/
    - derive/Ã¼/<v>/
    - xform/(.)ei$/$1<w>/
    - xform/uan$/<r>/
    - xform/[uv]e$/<t>/
    - xform/un$/<y>/
    - xform/^sh/<u>/
    - xform/^ch/<i>/
    - xform/^zh/<v>/
    - xform/uo$/<o>/
    - xform/ie$/<p>/
    - xform/(.)i?ong$/$1<s>/
    - xform/ing$|uai$/<k>/
    - xform/(.)ai$/$1<d>/
    - xform/(.)en$/$1<f>/
    - xform/(.)eng$/$1<g>/
    - xform/[iu]ang$/<l>/
    - xform/(.)ang$/$1<h>/
    - xform/ian$/<m>/
    - xform/(.)an$/$1<j>/
    - xform/(.)ou$/$1<z>/
    - xform/[iu]a$/<x>/
    - xform/iao$/<n>/
    - xform/(.)ao$/$1<c>/
    - xform/ui$/<v>/
    - xform/in$/<b>/
    - xform/<|>/
    # - abbrev/^(.).+$/$1/
